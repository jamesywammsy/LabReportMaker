//Compile.java
//Compile menu, exports a docx document
//Made by James Zhang and Maggie Pang
//Last edit: Jan 18

//TODO: Finish the rest of the buttons; Add in the ordering feature; Add in preview feature

//imports
import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.WindowConstants;

import org.apache.poi.xwpf.usermodel.ParagraphAlignment;
import org.apache.poi.xwpf.usermodel.XWPFDocument;
import org.apache.poi.xwpf.usermodel.XWPFParagraph;
import org.apache.poi.xwpf.usermodel.XWPFRun;
import org.apache.poi.xwpf.usermodel.XWPFTable;
import org.apache.poi.xwpf.usermodel.XWPFTableRow;
import java.io.FileOutputStream;
import java.io.IOException;

public class Compile extends JFrame implements ActionListener {

	// final variables
	private static final int PANEL_WIDTH = 700;
	private static final int PANEL_HEIGHT = 700;
	private static final int BUTTON_WIDTH = 150;
	private static final int BUTTON_HEIGHT = 50;

	public String title;
	public String contributors;
	
	Dimension u1 = new Dimension(60,60);

	// button variables
	JButton return_;
	JButton download_;

	JButton data;
	JButton analysis;

	JButton table1_;
	JButton table2_;
	JButton table3_;
	JButton table4_;
	JButton table5_;
	JButton table6_;
	JButton table7_;
	JButton table8_;

	JButton para1_;
	JButton para2_;
	JButton para3_;
	JButton para4_;
	JButton para5_;
	JButton para6_;
	JButton para7_;
	JButton para8_;

	// object declarations
	Menu menu;
	Abstract abstract_;
	Method method;
	CreateTable table1;
	CreateTable table2;
	CreateTable table3;
	CreateTable table4;
	CreateTable table5;
	CreateTable table6;
	CreateTable table7;
	CreateTable table8;

	CreatePara para1;
	CreatePara para2;
	CreatePara para3;
	CreatePara para4;
	CreatePara para5;
	CreatePara para6;
	CreatePara para7;
	CreatePara para8;

	SourcesOfError sourcesoferror;
	Conclusion conclusion;
	Citations citations;

	private int r;
	private int c;

	public Compile(Menu menu, Abstract abstract_, Method method, CreateTable table1, CreateTable table2,
			CreateTable table3, CreateTable table4, CreateTable table5, CreateTable table6, CreateTable table7,
			CreateTable table8, CreatePara para1, CreatePara para2, CreatePara para3, CreatePara para4,
			CreatePara para5, CreatePara para6, CreatePara para7, CreatePara para8, SourcesOfError sourcesoferror,
			Conclusion conclusion, Citations citations) {

		this.menu = menu;
		this.abstract_ = abstract_;
		this.method = method;
		this.table1 = table1;
		this.table2 = table2;
		this.table3 = table3;
		this.table4 = table4;
		this.table5 = table5;
		this.table6 = table6;
		this.table7 = table7;
		this.table8 = table8;

		this.para1 = para1;
		this.para2 = para2;
		this.para3 = para3;
		this.para4 = para4;
		this.para5 = para5;
		this.para6 = para6;
		this.para7 = para7;
		this.para8 = para8;

		this.sourcesoferror = sourcesoferror;
		this.conclusion = conclusion;
		this.citations = citations;

		title = menu.title;
		contributors = menu.contributors;

		// window sizing
		this.setTitle("GHHSB Lab Report System - Compile");
		this.setSize(PANEL_WIDTH, PANEL_HEIGHT);
		this.setResizable(false);
		this.setLocationRelativeTo(null);
		this.setFocusable(true); // make everything in this class appear on the screen
		this.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
		this.getContentPane().setBackground(Color.WHITE);
		HideWindow();

		Container c = getContentPane();
		c.setLayout(null);

		// button instantiations
		return_ = new JButton("Return");
		return_.addActionListener(this);
		return_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
		return_.setLocation(125, 600);

		download_ = new JButton("Download");
		download_.addActionListener(this);
		download_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
		download_.setLocation(415, 600);

		if (this.table1 != null) {
			table1_ = new JButton("Table 1");
			table1_.addActionListener(this);
			table1_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table1_.setLocation(20, 60);
			c.add(table1_);
		}

		if (this.table2 != null) {
			table2_ = new JButton("Table 2");
			table2_.addActionListener(this);
			table2_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table2_.setLocation(20, 150);
			c.add(table2_);
		}

		if (this.table3 != null) {
			table3_ = new JButton("Table 3");
			table3_.addActionListener(this);
			table3_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table3_.setLocation(20, 210);
			c.add(table3_);
		}

		if (this.table4 != null) {
			table4_ = new JButton("Table 4");
			table4_.addActionListener(this);
			table4_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table4_.setLocation(20, 270);
			c.add(table4_);
		}

		if (this.table5 != null) {
			table5_ = new JButton("Table 5");
			table5_.addActionListener(this);
			table5_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table5_.setLocation(20, 330);
			c.add(table5_);
		}

		if (this.table6 != null) {
			table6_ = new JButton("Table 6");
			table6_.addActionListener(this);
			table6_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table6_.setLocation(20, 390);
			c.add(table6_);
		}

		if (this.table7 != null) {
			table7_ = new JButton("Table 7");
			table7_.addActionListener(this);
			table7_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table7_.setLocation(20, 450);
			c.add(table7_);
		}

		if (this.table8 != null) {
			table8_ = new JButton("Table 8");
			table8_.addActionListener(this);
			table8_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			table8_.setLocation(20, 510);
			c.add(table8_);
		}

		if (this.para1 != null) {
			para1_ = new JButton("Para 1");
			para1_.addActionListener(this);
			para1_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para1_.setLocation(60, 60);
			c.add(para1_);
		}

		if (this.para2 != null) {
			para2_ = new JButton("Para 2");
			para2_.addActionListener(this);
			para2_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para2_.setLocation(60, 150);
			c.add(para2_);
		}

		if (this.para3 != null) {
			para3_ = new JButton("Para 3");
			para3_.addActionListener(this);
			para3_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para3_.setLocation(60, 210);
			c.add(para3_);
		}

		if (this.para4 != null) {
			para4_ = new JButton("Para 4");
			para4_.addActionListener(this);
			para4_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para4_.setLocation(60, 270);
			c.add(para4_);
		}

		if (this.para5 != null) {
			para5_ = new JButton("Para 5");
			para5_.addActionListener(this);
			para5_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para5_.setLocation(60, 330);
			c.add(para5_);
		}

		if (this.para6 != null) {
			para6_ = new JButton("Para 6");
			para6_.addActionListener(this);
			para6_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para6_.setLocation(60, 390);
			c.add(para6_);
		}

		if (this.para7 != null) {
			para7_ = new JButton("Para 7");
			para7_.addActionListener(this);
			para7_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para7_.setLocation(60, 450);
			c.add(para7_);
		}

		if (this.para8 != null) {
			para8_ = new JButton("Para 8");
			para8_.addActionListener(this);
			para8_.setSize(BUTTON_WIDTH, BUTTON_HEIGHT);
			para8_.setLocation(60, 510);
			c.add(para8_);
		}

		// adds buttons
		c.add(return_);
		c.add(download_);
		
		repaint();
	}

	public void paint(Graphics g) {

		super.paint(g);

	}

	public void HideWindow() {
		setVisible(false);
	}

	public void ShowWindow() {
		setVisible(true);
	}

	public void CompileTitlePage(XWPFDocument doc) {

		// Create a paragraph
		XWPFParagraph para = doc.createParagraph();

		// Create a run within the paragraph 
		XWPFRun run = para.createRun();

		run.setFontSize(24);
		para.setAlignment(ParagraphAlignment.CENTER);

		run.addBreak();
		run.addBreak();
		run.addBreak();
		run.addBreak();
		run.addBreak();
		run.addBreak();
		run.addBreak();
		run.addBreak();
		run.addBreak();
		run.setFontFamily("Times New Roman");

		// Add text to the run
		run.setText(title);
	}

	public void CompileContributors(XWPFDocument doc) {

		
		int runTime = 24;
		String[] contributors_ = contributors.split(", ");

		// Create a paragraph
		XWPFParagraph para = doc.createParagraph();

		// Create a run within the paragraph 
		XWPFRun run = para.createRun();

		run.setFontSize(12);
		para.setAlignment(ParagraphAlignment.RIGHT);

		for (int a = 0; a < contributors_.length; a++) {
			runTime--;
		}
		
		for (int i = 0; i < runTime; i++) {
			run.addBreak();
		}

		run.setFontFamily("Times New Roman");

		for (int i = 0; i < contributors_.length; i++) {

			run.setText(contributors_[i]);
			run.addBreak();
		}
	}

	public void CompileParagraph(XWPFDocument doc, String paragraph) {

		// Split the input string into paragraphs
		String[] paragraphs = paragraph.split("\n\n");

		for (int i = 0; i < paragraphs.length; i++) {

			// Create a new paragraph for each segment
			XWPFParagraph para = doc.createParagraph();

			// Create a run within the paragraph
			XWPFRun run = para.createRun();
			run.setFontFamily("Times New Roman");

			// Add text to the run
			run.setText(paragraphs[i]);

			run.addBreak();

		}

	}

	public void CompileTable(XWPFDocument doc, String[][] tableData, int row, int col) {

		// create table
		XWPFTable table = doc.createTable();

		if (row >= 1) {

			// create first row
			XWPFTableRow tableRowOne = table.getRow(0);
			tableRowOne.getCell(0).setText(tableData[0][0]);

			for (int i = 1; i < col; i++) {
				tableRowOne.addNewTableCell().setText(tableData[0][i]);
			}
		}

		if (row >= 2) {
			// create second row
			XWPFTableRow tableRowTwo = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowTwo.getCell(i).setText(tableData[1][i]);
			}

		}

		if (row >= 3) {
			// create third row
			XWPFTableRow tableRowThree = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowThree.getCell(i).setText(tableData[2][i]);
			}
		}

		if (row >= 4) {
			// create fourth row
			XWPFTableRow tableRowFour = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowFour.getCell(i).setText(tableData[3][i]);
			}
		}

		if (row >= 5) {
			// create third row
			XWPFTableRow tableRowFive = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowFive.getCell(i).setText(tableData[4][i]);
			}
		}

		if (row >= 6) {
			// create third row
			XWPFTableRow tableRowSix = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowSix.getCell(i).setText(tableData[5][i]);
			}
		}

		if (row >= 7) {
			// create third row
			XWPFTableRow tableRowSeven = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowSeven.getCell(i).setText(tableData[6][i]);
			}
		}

		if (row >= 8) {
			// create third row
			XWPFTableRow tableRowEight = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowEight.getCell(i).setText(tableData[7][i]);
			}
		}

		if (row >= 9) {
			// create third row
			XWPFTableRow tableRowNine = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowNine.getCell(i).setText(tableData[8][i]);
			}
		}

		if (row >= 10) {
			// create third row
			XWPFTableRow tableRowTen = table.createRow();

			for (int i = 0; i < col; i++) {
				tableRowTen.getCell(i).setText(tableData[9][i]);
			}
		}
	}

	public void CompileTable(XWPFDocument document, CreateTable table) {
		if (table != null) {

			// sets row and col length parameters
			r = table.row;
			c = table.col;

			CompileTable(document, table.data, r, c);

		}
	}

	public void CreateHeading(XWPFDocument document, String name) {

		// Create a paragraph
		XWPFParagraph para = document.createParagraph();

		// Create a run within the paragraph 
		XWPFRun run = para.createRun();
		run.setFontFamily("Times New Roman");
		run.setBold(true);

		run.setFontSize(12);
		run.setText(name);
		run.addBreak();

	}

	public void CompileCitations(XWPFDocument document) {

		// Split the input string into paragraphs
		String[] citations_ = citations.input.split("\n\n");

		for (int i = 0; i < citations_.length; i++) {

			// Create a new paragraph for each segment
			XWPFParagraph para = document.createParagraph();

			// Create a run within the paragraph
			XWPFRun run = para.createRun();
			run.setFontFamily("Times New Roman");
			run.setItalic(true);

			// Add text to the run
			run.setText(citations_[i]);

			run.addBreak();

		}

	}

	@Override
	public void actionPerformed(ActionEvent e) {

		// returns to main menu
		if (e.getSource() == return_) {

			HideWindow();
			menu.ShowWindow();

		} else if (e.getSource() == download_) {

			try {
				// Create a new Word document
				XWPFDocument document = new XWPFDocument();

				CompileTitlePage(document);
				CompileContributors(document);

				document.createParagraph().createRun().addBreak();

				CreateHeading(document, "I. Abstract");

				CompileParagraph(document, abstract_.input);

				CreateHeading(document, "II. Theory");

				CreateHeading(document, "III. Method");

				CompileParagraph(document, method.input);

				CreateHeading(document, "IV. Data");

				CreateHeading(document, "V. Analysis");

				CreateHeading(document, "VI. Sources of Error");

				CompileParagraph(document, sourcesoferror.input);

				CreateHeading(document, "VII. Conclusion");

				CompileParagraph(document, conclusion.input);

				CreateHeading(document, "VIII. Sources");

				CompileCitations(document);

				CompileTable(document, table1);
				CompileTable(document, table2);
				CompileTable(document, table3);
				CompileTable(document, table4);
				CompileTable(document, table5);
				CompileTable(document, table6);
				CompileTable(document, table7);
				CompileTable(document, table8);

				// Specify the output file path in the Downloads folder
				String home = System.getProperty("user.home");
				String filePath = home + "/Downloads/Lab Report.docx";

				// Create a FileOutputStream to write the document to a file
				try (FileOutputStream out = new FileOutputStream(filePath)) {

					// Write the document to the file
					document.write(out);
				}

			} catch (IOException ex) {
				ex.printStackTrace();
			}

			// ends program
			System.exit(0);

		}
	}

}
